#!/usr/bin/env bash
# setup environment

#
# CONFIG
#
RUBY_VERSION=1.9.2
GIT_REPO=https://github.com/delonnewman/dotfiles.git
TMP_DIR=/tmp
PREREQS=(git curl)
PACKAGES=(vim-gnome openssh-client)

#
# COLORS
#

function install {
	pkgs=$@
	for pkg in ${pkgs[@]}; do
		path=$(which $pkg)
		if [ -z $path ]; then
			echo Installing $pkg...
			sudo apt-get -y --force-yes install $pkg
			echo DONE.
		else
			echo $pkg is already installed.
		fi
	done

}

echo "=> Installing prereqs..."
echo

# install prereqs
install ${PREREQS[@]}

if [[ -s "$HOME/.rvm/scripts/rvm" ]]; then
	echo rvm is already installed.
else
	bash < <(curl -s https://rvm.beginrescueend.com/install/rvm)
fi

ruby=$(ruby -v)
if [[ $ruby =~ $RUBY_VERSION ]]; then
	echo ruby-$RUBY_VERSION is already installed.
else
	# install ruby version and set as default
	rvm install $RUBY_VERSION && rvm use $RUBY_VERSION --default
fi

echo
echo 'DONE. -->  WOOT!'
echo ===================================================================
echo "==> fetching dotfiles repo from $GIT_REPO into $TMP_DIR..."
echo

# install dotfiles
cd $TMP_DIR &&
git clone $GIT_REPO &&
cd dotfiles &&
rake install &&
cd .. &&
rm -rf dotfiles

# install other packages
echo
echo OK, the basics are done. Installing some other useful packages...
echo '====>'

install ${PACKAGES[@]}

echo
echo 'Your environment is configured... mostly ;-)'
