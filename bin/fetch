#!/usr/bin/env bash
# setup environment

RUBY_VERSION=1.9.2
GIT_REPO=https://github.com/delonnewman/dotfiles.git
TMP_DIR=/tmp

function install {
	pkg=$1
	cmd=$2
	path=$(which $pkg)
	if [ -z $path ]; then
		echo Installing $pkg...
		if [ -z $cmd ]; then
			sudo apt-get -y --force-yes install $pkg
		else
			$($cmd)
		fi
		echo DONE.
	else
		echo $pkg is already installed.
	fi

}

echo "=> Installing prereqs..."
echo

# install prereqs
install git
install curl

if [[ -s "$HOME/.rvm/scripts/rvm" ]]; then
	echo rvm is already installed.
else
	bash < <(curl -s https://rvm.beginrescueend.com/install/rvm)
fi

ruby=$(ruby -v)
if [[ $ruby =~ $RUBY_VERSION ]]; then
	echo ruby-$RUBY_VERSION is already installed.
else
	# install ruby version and set as default
	rvm install $RUBY_VERSION && rvm use $RUBY_VERSION --default
fi

echo
echo 'DONE. -->  WOOT!'
echo ===================================================================
echo "==> fetching dotfiles repo from $GIT_REPO into $TMP_DIR..."
echo

# install dotfiles
cd $TMP_DIR &&
git clone $GIT_REPO &&
cd dotfiles &&
rake install &&
cd .. &&
rm -rf dotfiles

echo
echo 'Your environment is configured... mostly ;-)'
